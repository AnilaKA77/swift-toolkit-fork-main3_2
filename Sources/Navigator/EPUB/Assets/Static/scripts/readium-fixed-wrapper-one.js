(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e={SINGLE:"single",SPREAD_LEFT:"spread-left",SPREAD_RIGHT:"spread-right",SPREAD_CENTER:"spread-center"},n={AUTO:"auto",PAGE:"page",WIDTH:"width"};var i=function(t,i){var l=null,o=null,a=null,r=n.AUTO,s=Object.values(e).includes(i)?i:e.SINGLE,u=document.getElementById("page");u.addEventListener("load",(function(){var t,e,n;l=null!==(t=null!==(e=function(){var t=u.contentWindow.document.querySelector("meta[name=viewport]");if(!t)return null;for(var e,n=/(\w+) *= *([^\s,]+)/g,i={};e=n.exec(t.content);)i[e[1]]=e[2];var l=Number.parseFloat(i.width),o=Number.parseFloat(i.height);return l&&o?{width:l,height:o}:null}())&&void 0!==e?e:(n=u.contentWindow.document.querySelector("img"))&&n.naturalWidth&&n.naturalHeight?{width:n.naturalWidth,height:n.naturalHeight}:null)&&void 0!==t?t:o,d()}));var c=u.closest(".viewport");function d(){if(l&&o&&a){u.style.width=l.width+"px",u.style.height=l.height+"px";var t,i=o.width/l.width,c=o.height/l.height;t=r===n.WIDTH?i:Math.min(i,c);var d=l.height*t,h=s===e.SINGLE||s===e.SPREAD_CENTER;if(r===n.WIDTH&&d>o.height)u.style.top=a.top+"px",u.style.transform=h?"translateX(-50%)":"none";else{var m=a.top-a.bottom;u.style.top="calc(50% + "+m+"px)",u.style.transform=h?"translate(-50%, -50%)":"translateY(-50%)"}document.querySelector("meta[name=viewport]").content="initial-scale="+t+", minimum-scale="+t}}function h(t){u.src.startsWith("blob:")&&URL.revokeObjectURL(u.src),u.src=t}return{isLoading:!1,link:null,load:function(t,e){if(t.link&&t.url){var n=this;n.link=t.link,n.isLoading=!0,u.addEventListener("load",(function i(){u.removeEventListener("load",i),setTimeout((function(){n.isLoading=!1,u.contentWindow.eval(`readium.link = ${JSON.stringify(t.link)};`),e&&e()}),100)}));var i=function(t){if((e=t.link.type)&&e.startsWith("image/")&&!e.includes("svg")){let e=function(t,e){let n=document.implementation.createHTMLDocument(""),i=n.createElement("meta");i.name="viewport",i.content="width=device-width, height=device-height",n.head.appendChild(i);let l=n.createElement("style");l.textContent="body { margin: 0; }\nimg { display: block; width: 100%; height: 100%; object-fit: contain; }",n.head.appendChild(l);let o=n.createElement("img");return o.src=t,e&&(o.alt=e),n.body.appendChild(o),"<!DOCTYPE html>\n"+n.documentElement.outerHTML}(t.url,t.link.title),n=new Blob([e],{type:"text/html"});return URL.createObjectURL(n)}return t.url;var e}(t);h(i)}else e&&e()},reset:function(){this.link&&(this.link=null,l=null,h("about:blank"))},eval:function(t){if(this.link&&!this.isLoading)return u.contentWindow.eval(t)},setViewport:function(t,e,i){o=t,a=e,Object.values(n).includes(i)&&(r=i),d()},show:function(){c.style.display="block"},hide:function(){c.style.display="none"}}}(0,e.SINGLE);t.g.spread={load:function(t){0!==t.length&&i.load(t[0],(function(){webkit.messageHandlers.spreadLoaded.postMessage({})}))},eval:function(t,e){var n;if("#"===t||""===t||(null===(n=i.link)||void 0===n?void 0:n.href)===t)return i.eval(e)},setViewport:function(t,e,n){i.setViewport(t,e,n)}}})();
//# sourceMappingURL=readium-fixed-wrapper-one.js.map